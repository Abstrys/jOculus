<?xml version="1.0" encoding="UTF-8" ?>
<project name="jOculus" default="build" basedir=".">
   <description>Build Antiword</description>

   <!-- set global properties for this build -->
   <property name="src" location="src"/>
   <property name="build" location="build"/>
   <property name="dist"  location="dist"/>

   <target name="init">
      <tstamp/> <!-- Create the time stamp -->
      <echo>${ant.project.name} build ${DSTAMP}${TSTAMP}</echo>
   </target>

   <path id="build.classpath">
      <fileset dir="${basedir}/">
         <include name="${lib.dir}/*.jar"/>
      </fileset>
   </path>

   <pathconvert property="mf.classpath" pathsep=" ">
      <path refid="build.classpath"/>
      <mapper>
         <chainedmapper>
            <flattenmapper/>
            <globmapper from="*.jar" to="lib/*.jar"/>
         </chainedmapper>
      </mapper>
   </pathconvert>


   <!-- Build all -->
   <target name="all" depends="build" description="Build all"/>

   <!-- Build pwgen, the command-line application -->
   <target name="build" depends="init" description="Build ${ant.project.name}">
      <mkdir dir="${build}/"/>
      <javac srcdir="${src}" destdir="${build}" includeantruntime="false">
      <classpath id="classpath" description="The default classpath.">
        <pathelement path="${classpath}"/>
        <fileset dir="lib">
          <include name="*.jar"/>
        </fileset>
      </classpath>
      </javac>
      <mkdir dir="${dist}/"/>
      <jar destfile="${dist}/${ant.project.name}.jar" index="true" indexMetaInf="true" basedir="${build}">
         <manifest>
            <attribute name="Built-By" value="${user.name}"/>
            <attribute name="Main-Class" value="abstrys.joculus.Joculus"/>
            <attribute name="Class-Path" value="abstrys.joculus.Joculus"/>
            <attribute name="Sealed" value="true"/>
         </manifest>
      </jar>
   </target>

   <target name="run" description="run the app">
      <java jar="${dist}/${ant.project.name}.jar" fork="true">
      <sysproperty key="DEBUG" value="true"/>
      <arg value="${basedir}/testfiles/test.md"/>
    </java>
   </target>

   <target name="clean" description="clean up the build" >
      <delete dir="${build}"/>
   </target>

   <target name="spotless" depends="clean" description="clean everything, including the dist directory">
      <delete dir="${dist}"/>
   </target>
</project>
